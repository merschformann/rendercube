<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>rendercube export</title>
        <style>
            body {
                margin: 0;
            }
            canvas {
                display: block; /* fix necessary to remove space at bottom of canvas */
            }
            .ui {
                position: absolute;
                margin: 20px;
            }
            button {
                margin: 2px;
            }
        </style>
    </head>
    <body>
        <div style="right: 0" id="health" class="ui">
            <p style="width: 100%; text-align: center; color: white">
                Pieces: 189, Offload: 182, Containers: 20
            </p>
            <select name="select-color-mode">
                <option value="sorted">Sorted colors</option>
                <option value="index">Indexed colors</option>
                <option value="random">Random colors</option>
            </select>
        </div>

        <!-- <script src="https://cdn.jsdelivr.net/npm/three@0.121.1/build/three.min.js"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/three@0.121.1/build/three.js"></script>

        <script type="module">
            import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.121.1/examples/jsm/controls/OrbitControls.js";
            import { EffectComposer } from "https://cdn.jsdelivr.net/npm/three@0.121.1/examples/jsm/postprocessing/EffectComposer.js";
            import { GlitchPass } from "https://cdn.jsdelivr.net/npm/three@0.121.1/examples/jsm/postprocessing/GlitchPass.js";
            import { RenderPass } from "https://cdn.jsdelivr.net/npm/three@0.121.1/examples/jsm/postprocessing/RenderPass.js";
            // import { OutputPass } from "https://cdn.jsdelivr.net/npm/three@0.121.1/examples/jsm/postprocessing/OutputPass.js";

            // import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.121.1/build/three.min.js';

            // zoomCameraToSelection zooms the camera to fit the selection.
            // This needs to be improved as it doesn't work for small objects.
            function zoomCameraToSelection(
                camera,
                controls,
                selection,
                fitOffset = 1.2
            ) {
                const box = new THREE.Box3();

                for (const object of selection) box.expandByObject(object);

                const size = box.getSize(new THREE.Vector3());
                const center = box.getCenter(new THREE.Vector3());

                const maxSize = Math.max(size.x, size.y, size.z);
                const fitHeightDistance =
                    maxSize / (2 * Math.atan((Math.PI * camera.fov) / 360));
                const fitWidthDistance = fitHeightDistance / camera.aspect;
                const distance =
                    fitOffset * Math.max(fitHeightDistance, fitWidthDistance);

                const direction = controls.target
                    .clone()
                    .sub(camera.position)
                    .normalize()
                    .multiplyScalar(distance);

                controls.maxDistance = distance * 10;
                controls.target.copy(center);

                camera.near = distance / 100;
                camera.far = distance * 100;
                camera.updateProjectionMatrix();

                camera.position.copy(controls.target).sub(direction);

                controls.update();
            }

            // shuffleArray shuffles the given array.
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Parse data (will be injected)
            var data = JSON.parse(`{"containers":[{"id":4,"assignments":[{"piece":306,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.9,"height":1.8}]},{"piece":155,"position":{"x":1,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.9,"width":1.9,"height":1.9}]},{"piece":57,"position":{"x":0,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":0.9,"height":2}]},{"piece":10,"position":{"x":0,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.4,"height":1.2}]},{"piece":127,"position":{"x":0,"y":1.9,"z":2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.4,"height":1.2}]},{"piece":334,"position":{"x":0,"y":2.8,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":0.7,"height":1.9}]},{"piece":130,"position":{"x":1.9,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.7,"width":1.9,"height":1.7}]},{"piece":106,"position":{"x":1.9,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.7,"width":1.5,"height":2}]},{"piece":133,"position":{"x":1.8,"y":1.4,"z":2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.8,"width":1.7,"height":1.2}]},{"piece":351,"position":{"x":1.9,"y":0,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.7,"width":1.2,"height":1.5}]},{"piece":55,"position":{"x":0,"y":1.4,"z":1.9,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":0.5,"height":1.3}]}],"length":2.6,"width":3.5,"height":3.2},{"id":19,"assignments":[{"piece":333,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.7,"height":1.6}]},{"piece":120,"position":{"x":1.3,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.8,"height":1.6}]},{"piece":40,"position":{"x":0,"y":1.8,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.4,"height":1.6}]},{"piece":305,"position":{"x":0,"y":0,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.6,"height":1.5}]},{"piece":53,"position":{"x":0,"y":1.6,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":2,"width":1.1,"height":1.5}]},{"piece":81,"position":{"x":2,"y":0,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":2,"height":1.5}]},{"piece":214,"position":{"x":1.5,"y":1.8,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.4,"height":1.6}]},{"piece":2,"position":{"x":2,"y":2,"z":1.6,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":1.4,"height":1.4}]},{"piece":5,"position":{"x":2.5,"y":0,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.8,"height":1.6}]},{"piece":117,"position":{"x":0,"y":2.7,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":0.6,"height":1.5}]},{"piece":52,"position":{"x":1.4,"y":0,"z":1.6,"a":0,"b":90,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.6,"height":1.4}]}],"length":3.1,"width":3.4,"height":3.1},{"id":16,"assignments":[{"piece":208,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.2,"height":1.7}]},{"piece":318,"position":{"x":0,"y":1.2,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.4,"height":1.6}]},{"piece":304,"position":{"x":0,"y":1.2,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":2,"height":1.9}]},{"piece":18,"position":{"x":0,"y":2.5999999999999996,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.3,"height":1.5}]},{"piece":347,"position":{"x":0,"y":0,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1,"height":1.9}]},{"piece":249,"position":{"x":1,"y":1.2,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.6,"height":1.5}]},{"piece":315,"position":{"x":1,"y":2.8,"z":1.5,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.1,"height":1.9}]},{"piece":88,"position":{"x":1.9,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.8,"height":1.6}]},{"piece":30,"position":{"x":1.9,"y":1.8,"z":0,"a":0,"b":90,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.9,"height":1.5}]},{"piece":76,"position":{"x":1.9,"y":0,"z":1.6,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.1,"height":1.9}]},{"piece":36,"position":{"x":1,"y":1.2,"z":3.1,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.6,"height":0.5}]},{"piece":147,"position":{"x":0,"y":3.4,"z":1.5,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":0.5,"height":2}]}],"length":2.5,"width":3.9,"height":3.6},{"id":9,"assignments":[{"piece":64,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.9,"height":1.9}]},{"piece":6,"position":{"x":0,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.8,"height":1.8}]},{"piece":320,"position":{"x":0,"y":1.9,"z":1.8,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":2,"width":1.6,"height":1.9}]},{"piece":99,"position":{"x":0,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.8,"height":1.7}]},{"piece":141,"position":{"x":1.9,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.9,"height":1.9}]},{"piece":217,"position":{"x":1.9,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.9,"height":1.9}]},{"piece":136,"position":{"x":2,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.9,"height":1.9}]},{"piece":77,"position":{"x":2,"y":1.9,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.8,"height":2}]}],"length":3.2,"width":3.8,"height":3.9},{"id":18,"assignments":[{"piece":263,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.5,"height":1.2}]},{"piece":329,"position":{"x":0,"y":1.5,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.2,"height":1.6}]},{"piece":326,"position":{"x":1.4,"y":1.5,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":1.4,"height":1.7}]},{"piece":302,"position":{"x":0,"y":2.7,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1,"height":2}]},{"piece":188,"position":{"x":1.5,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.4,"height":1.3}]},{"piece":8,"position":{"x":1.4,"y":2.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":0.9,"height":1.7}]},{"piece":286,"position":{"x":0,"y":0,"z":1.3,"a":0,"b":90,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.5,"height":0.8}]},{"piece":169,"position":{"x":1.7,"y":0,"z":1.3,"a":0,"b":90,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.5,"height":0.9}]},{"piece":19,"position":{"x":2.5,"y":1.5,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.5,"width":1.4,"height":1.5}]},{"piece":124,"position":{"x":1.3,"y":1.5,"z":1.7,"a":0,"b":90,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.4,"height":0.5}]},{"piece":343,"position":{"x":0,"y":1.5,"z":1.6,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.2,"height":0.6}]},{"piece":307,"position":{"x":1.3,"y":2.9,"z":1.7,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1,"height":0.5}]}],"length":3,"width":3.9,"height":2.2},{"id":2,"assignments":[{"piece":246,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.6,"height":1.3}]},{"piece":176,"position":{"x":1.5,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.4,"height":1.3}]},{"piece":284,"position":{"x":0,"y":0,"z":1.3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.8,"height":1.7}]},{"piece":268,"position":{"x":1,"y":0,"z":1.3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1.9,"height":1}]},{"piece":336,"position":{"x":2.6,"y":0,"z":1.3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.9,"width":1.8,"height":1.7}]},{"piece":206,"position":{"x":1.5,"y":1.4,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.2,"height":1.2}]},{"piece":61,"position":{"x":0,"y":1.6,"z":0,"a":0,"b":90,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1,"height":1.3}]},{"piece":247,"position":{"x":0,"y":1.9,"z":1.3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":0.7,"height":1.5}]},{"piece":138,"position":{"x":1.8,"y":1.9,"z":1.2,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":0.6,"height":1.8}]},{"piece":145,"position":{"x":1,"y":0,"z":2.3,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1.9,"height":0.6}]}],"length":3.6,"width":2.6,"height":3},{"id":3,"assignments":[{"piece":80,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.9,"height":1.4}]},{"piece":296,"position":{"x":0,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":2,"width":1.7,"height":1.4}]},{"piece":113,"position":{"x":0,"y":0,"z":1.4,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.7,"height":1.5}]},{"piece":9,"position":{"x":0,"y":1.7,"z":1.4,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.8,"height":1.4}]},{"piece":168,"position":{"x":1.8,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.9,"height":1.7}]},{"piece":313,"position":{"x":2,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.9,"height":1.7}]},{"piece":107,"position":{"x":1.8,"y":0,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.9,"height":1.3}]},{"piece":111,"position":{"x":1.8,"y":1.9,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.7,"height":1.2}]}],"length":3.2,"width":3.8,"height":3},{"id":5,"assignments":[{"piece":109,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":2,"height":1.6}]},{"piece":222,"position":{"x":0,"y":2,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.5,"height":2}]},{"piece":218,"position":{"x":0,"y":0,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.9,"height":1.4}]},{"piece":310,"position":{"x":0,"y":2,"z":2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.4,"height":2}]},{"piece":239,"position":{"x":0,"y":0,"z":3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.9,"height":1}]},{"piece":23,"position":{"x":1.7,"y":2,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.8,"width":1.7,"height":1.9}]},{"piece":312,"position":{"x":1.7,"y":1.9,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.7,"width":1.9,"height":1.9}]},{"piece":258,"position":{"x":1.6,"y":0,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.8,"width":1.7,"height":1.6}]},{"piece":346,"position":{"x":1.9,"y":0,"z":1.6,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.9,"height":1.8}]},{"piece":180,"position":{"x":1.8,"y":0,"z":3.4000000000000004,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.7,"width":1.8,"height":0.6}]}],"length":2.5,"width":3.8,"height":4},{"id":17,"assignments":[{"piece":195,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1,"height":1.5}]},{"piece":170,"position":{"x":0,"y":1,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.2,"height":1.1}]},{"piece":70,"position":{"x":0,"y":1,"z":1.1,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1,"height":1.4}]},{"piece":365,"position":{"x":1.5,"y":0,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1,"height":1.7}]},{"piece":367,"position":{"x":1.7,"y":1,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.2,"height":1.8}]},{"piece":39,"position":{"x":0,"y":0,"z":1.7,"a":0,"b":90,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1,"height":0.9}]},{"piece":33,"position":{"x":1.6,"y":1,"z":1.8,"a":0,"b":90,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":1.2,"height":0.8}]},{"piece":167,"position":{"x":1.9,"y":0,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":0.8,"height":0.9}]}],"length":2.9,"width":2.2,"height":2.6},{"id":0,"assignments":[{"piece":368,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":2,"height":1.8}]},{"piece":66,"position":{"x":1.3,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.6,"height":1.9}]},{"piece":101,"position":{"x":1.3,"y":1.6,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.8,"height":1.4}]},{"piece":328,"position":{"x":1.3,"y":1.6,"z":1.4,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.5,"height":1.4}]},{"piece":321,"position":{"x":0,"y":2,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.3,"width":1.3,"height":2}]},{"piece":348,"position":{"x":0,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":2,"width":1.6,"height":0.9}]},{"piece":183,"position":{"x":2.8,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.9,"width":1.6,"height":1.9}]},{"piece":314,"position":{"x":2,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.6,"height":0.8}]},{"piece":172,"position":{"x":0,"y":1.6,"z":2.0999999999999996,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.9,"height":0.7}]},{"piece":359,"position":{"x":3,"y":1.6,"z":0,"a":90,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.9,"height":1.3}]}],"length":3.7,"width":3.5,"height":2.8},{"id":7,"assignments":[{"piece":158,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.9,"height":1.7}]},{"piece":11,"position":{"x":1.8,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":2,"height":1.9}]},{"piece":335,"position":{"x":0,"y":2,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.5,"height":1.9}]},{"piece":202,"position":{"x":0,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":2,"width":1.8,"height":1.5}]},{"piece":131,"position":{"x":0,"y":1.8,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.8,"height":1.5}]},{"piece":266,"position":{"x":1.9,"y":2,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1.7,"height":1.7}]},{"piece":324,"position":{"x":1.9,"y":1.8,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.9,"height":1.3}]},{"piece":200,"position":{"x":2,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.6,"height":1.5}]}],"length":3.5,"width":3.8,"height":3.4},{"id":15,"assignments":[{"piece":139,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.5,"height":1.1}]},{"piece":44,"position":{"x":1.7,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.4,"height":1.1}]},{"piece":29,"position":{"x":0,"y":0,"z":1.1,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.9,"height":0.8}]},{"piece":51,"position":{"x":1.8,"y":0,"z":1.1,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":0.8,"height":2}]},{"piece":7,"position":{"x":1.8,"y":0.8,"z":1.1,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.3,"height":1.1}]},{"piece":31,"position":{"x":0,"y":0,"z":1.9000000000000001,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.8,"height":1}]},{"piece":215,"position":{"x":1.8,"y":0.8,"z":2.2,"a":90,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.3,"height":0.9}]},{"piece":116,"position":{"x":1.7,"y":1.4,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1,"height":1.1}]},{"piece":171,"position":{"x":0,"y":1.5,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":0.9,"height":1.1}]},{"piece":370,"position":{"x":0,"y":1.9,"z":1.1,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":0.5,"height":1.8}]}],"length":3.7,"width":2.4,"height":3.1},{"id":13,"assignments":[{"piece":322,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.8,"width":1.7,"height":1.7}]},{"piece":349,"position":{"x":0.8,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.4,"height":1.1}]},{"piece":332,"position":{"x":0.8,"y":0,"z":1.1,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.6,"height":1.2}]},{"piece":126,"position":{"x":2,"y":0,"z":1.1,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":1.7,"height":1.2}]},{"piece":303,"position":{"x":0,"y":0,"z":1.7,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":0.8,"width":2,"height":1.3}]},{"piece":323,"position":{"x":0.8,"y":0,"z":2.3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.6,"height":0.7}]},{"piece":86,"position":{"x":2.3,"y":0,"z":0,"a":0,"b":90,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.9,"width":2,"height":1.1}]},{"piece":211,"position":{"x":0.8,"y":1.4,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":0.6,"height":1.1}]},{"piece":27,"position":{"x":2.6,"y":0,"z":2.3,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":2,"height":0.7}]}],"length":3.3,"width":2,"height":3},{"id":1,"assignments":[{"piece":325,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.9,"height":1.3}]},{"piece":288,"position":{"x":1,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.4,"height":1.2}]},{"piece":192,"position":{"x":0,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.1,"height":1.4}]},{"piece":85,"position":{"x":1,"y":0,"z":1.2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.5,"height":1.1}]},{"piece":281,"position":{"x":0,"y":1.9,"z":1.4,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.1,"height":1.1}]},{"piece":259,"position":{"x":0,"y":0,"z":1.3,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.6,"height":1.4}]},{"piece":78,"position":{"x":1.5,"y":1.4,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.5,"height":1.2}]},{"piece":144,"position":{"x":1,"y":0,"z":2.3,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.9,"height":0.5}]},{"piece":213,"position":{"x":1.9,"y":1.5,"z":1.4,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.6,"width":1.5,"height":0.8}]}],"length":2.5,"width":3,"height":2.8},{"id":11,"assignments":[{"piece":4,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.5,"height":1.2}]},{"piece":223,"position":{"x":1.4,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":1.9,"height":1.2}]},{"piece":48,"position":{"x":0,"y":1.5,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.3,"height":1.6}]},{"piece":295,"position":{"x":2.5,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.9,"height":1.3}]},{"piece":364,"position":{"x":1.4,"y":1.9,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.2,"height":1.3}]},{"piece":331,"position":{"x":1.2,"y":0,"z":1.3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.9,"height":0.6}]},{"piece":94,"position":{"x":1.2,"y":1.9,"z":1.3,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":2,"width":1.1,"height":0.7}]},{"piece":97,"position":{"x":0,"y":0,"z":1.2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.5,"height":0.8}]},{"piece":125,"position":{"x":2.9,"y":1.9,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.7,"width":1,"height":1.3}]},{"piece":282,"position":{"x":3.0999999999999996,"y":0,"z":1.3,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":0.5,"width":1.8,"height":0.7}]}],"length":3.6,"width":3.1,"height":2},{"id":8,"assignments":[{"piece":96,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1,"height":1.2}]},{"piece":154,"position":{"x":0,"y":1,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1,"height":1.2}]},{"piece":264,"position":{"x":0,"y":0,"z":1.2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.2,"height":1}]},{"piece":265,"position":{"x":0,"y":1.2,"z":1.2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":0.9,"height":1.4}]},{"piece":253,"position":{"x":1.9,"y":0,"z":0,"a":90,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.7,"height":1.3}]},{"piece":49,"position":{"x":1.9,"y":0,"z":1.3,"a":90,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":1.8,"height":1.2}]},{"piece":165,"position":{"x":0,"y":0,"z":2.2,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.1,"height":0.6}]},{"piece":344,"position":{"x":1.9,"y":1.7,"z":0,"a":0,"b":90,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":1,"width":0.5,"height":1.3}]}],"length":2.9,"width":2.2,"height":2.9},{"id":6,"assignments":[{"piece":0,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.3,"height":1.9}]},{"piece":308,"position":{"x":0,"y":1.3,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.3,"height":1.9}]},{"piece":233,"position":{"x":1.7,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":2,"height":1.2}]},{"piece":275,"position":{"x":0,"y":2.6,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":2,"width":1.1,"height":1.8}]},{"piece":50,"position":{"x":2,"y":2,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.7,"height":1.8}]},{"piece":95,"position":{"x":1.7,"y":0,"z":1.2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.8,"height":1.2}]},{"piece":60,"position":{"x":1.7,"y":2,"z":1.8,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.8,"height":0.7}]},{"piece":260,"position":{"x":0,"y":0,"z":1.9,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.9,"height":0.7}]},{"piece":148,"position":{"x":0,"y":1.9,"z":1.9,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.8,"height":0.6}]}],"length":3.6,"width":3.8,"height":2.6},{"id":12,"assignments":[{"piece":132,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.3,"height":1.7}]},{"piece":257,"position":{"x":0,"y":1.3,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.4,"height":1.5}]},{"piece":108,"position":{"x":1.7,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.5,"height":1.7}]},{"piece":129,"position":{"x":0,"y":1.3,"z":1.5,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.4,"height":1.7}]},{"piece":300,"position":{"x":1.7,"y":0,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":1.4,"height":1.7}]},{"piece":89,"position":{"x":1.5,"y":1.4,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":1.2,"height":1.5}]},{"piece":235,"position":{"x":0,"y":0,"z":1.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1.1,"height":1.9}]},{"piece":134,"position":{"x":1.7,"y":1.5,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1.2,"height":1.7}]}],"length":3.4,"width":2.8,"height":3.6},{"id":10,"assignments":[{"piece":13,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.4,"height":1.8}]},{"piece":179,"position":{"x":0,"y":1.4,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":0.9,"height":2}]},{"piece":229,"position":{"x":0,"y":2.3,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1,"height":1.8}]},{"piece":269,"position":{"x":1.6,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.6,"height":1.5}]},{"piece":255,"position":{"x":1.6,"y":1.6,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":2,"height":1.3}]},{"piece":354,"position":{"x":1.6,"y":1.6,"z":1.3,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.9,"height":1}]},{"piece":261,"position":{"x":1.2,"y":0,"z":1.5,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.8,"width":1.3,"height":1}]},{"piece":207,"position":{"x":0,"y":2.3,"z":1.8,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.6,"width":1.3,"height":0.7}]},{"piece":198,"position":{"x":0,"y":0,"z":2,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.2,"width":1.8,"height":0.5}]}],"length":3,"width":3.7,"height":2.5},{"id":14,"assignments":[{"piece":358,"position":{"x":0,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":2,"height":0.7}]},{"piece":112,"position":{"x":1.9,"y":0,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.1,"height":1.4}]},{"piece":339,"position":{"x":0,"y":0,"z":0.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":1.7,"height":1.4}]},{"piece":190,"position":{"x":1.9,"y":0,"z":1.4,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.7,"width":1.7,"height":0.9}]},{"piece":156,"position":{"x":0,"y":1.7,"z":0.7,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.5,"width":0.8,"height":2}]},{"piece":1,"position":{"x":1.9,"y":1.1,"z":0,"a":0,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.4,"width":1.4,"height":1.2}]},{"piece":121,"position":{"x":1.1,"y":0,"z":0.7,"a":0,"b":0,"c":90},"cubes":[{"x":0,"y":0,"z":0,"length":0.7,"width":1.5,"height":2}]},{"piece":142,"position":{"x":0,"y":0,"z":2.0999999999999996,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.1,"width":1.7,"height":0.6}]},{"piece":150,"position":{"x":0,"y":2,"z":0,"a":90,"b":0,"c":0},"cubes":[{"x":0,"y":0,"z":0,"length":1.9,"width":0.5,"height":0.7}]}],"length":3.7,"width":2.5,"height":2.7}],"offload":[3,12,14,15,16,17,20,21,22,24,25,26,28,32,34,35,37,38,41,42,43,45,46,47,54,56,58,59,62,63,65,67,68,69,71,72,73,74,75,79,82,83,84,87,90,91,92,93,98,100,102,103,104,105,110,114,115,118,119,122,123,128,135,137,140,143,146,149,151,152,153,157,159,160,161,162,163,164,166,173,174,175,177,178,181,182,184,185,186,187,189,191,193,194,196,197,199,201,203,204,205,209,210,212,216,219,220,221,224,225,226,227,228,230,231,232,234,236,237,238,240,241,242,243,244,245,248,250,251,252,254,256,262,267,270,271,272,273,274,276,277,278,279,280,283,285,287,289,290,291,292,293,294,297,298,299,301,309,311,316,317,319,327,330,337,338,340,341,342,345,350,352,353,355,356,357,360,361,362,363,366,369],"data":null}`);

            // Create essentials
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );

            scene.background = new THREE.Color(0xf0f0f0);
            scene.background = new THREE.Color(0x000000);
            scene.add(new THREE.AmbientLight(0xffffff, 0.3));
            const light = new THREE.DirectionalLight(0xffffff, 0.7);
            light.position.set(1, 1, 0.5).normalize();
            scene.add(light);

            const renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.antialias = true;
            document.body.appendChild(renderer.domElement);

            // Add controls
            const controls = new OrbitControls(camera, renderer.domElement);

            // Count pieces in all containers
            let pieceCount = 0;
            let pieceIdxByCount = {};
            data.containers.forEach((container) => {
                container.assignments.forEach((piece) => {
                    pieceIdxByCount[pieceCount] = piece.piece;
                    pieceCount++;
                });
            });
            data.offload.forEach((pieceId) => {
                pieceIdxByCount[pieceCount] = pieceId;
                pieceCount++;
            });

            // Create rainbow color for each piece
            const colors = [];
            for (let i = 0; i < pieceCount; i++) {
                colors.push(
                    new THREE.Color(`hsl(${(i * 360) / pieceCount}, 100%, 50%)`)
                );
            }
            // Create random colors copy
            const randomColors = colors.slice();
            shuffleArray(randomColors);
            // Create another rainbow based on the index of the pieces (all seen in container assignments and offload)
            const maxIndex = Math.max(
                ...Object.values(pieceIdxByCount).map((pieceId) => {
                    return pieceId;
                })
            );
            console.log(maxIndex);
            const indexColors = [];
            for (let i = 0; i < maxIndex; i++) {
                indexColors.push(
                    new THREE.Color(`hsl(${(i * 360) / maxIndex}, 100%, 50%)`)
                );
            }
            // Extract custom color maps
            const customColorTypes = [];
            if (data?.data?.color_maps) {
                Object.keys(data.data.color_maps).forEach((colorType) => {
                    if (colorType !== "sorted" && colorType !== "random" && colorType !== "index") {
                        customColorTypes.push(colorType);
                    }
                });
            }

            // Create visuals for all elements
            const containers = [];
            pieceCount = 0;
            let containerOffset = 0;
            data.containers.forEach((container) => {
                // Create visual for container content
                const contentVisual = new THREE.Group();
                contentVisual.name = `Container ${container.id}`;
                for (let i = 0; i < container.assignments.length; i++) {
                    const piece = container.assignments[i];
                    const pieceVisual = new THREE.Group();
                    pieceVisual.name = `Piece ${piece.id}`;
                    piece.cubes.forEach((cube) => {
                        const cubeGroup = new THREE.Group();
                        const geometry = new THREE.BoxGeometry(
                            cube.length,
                            cube.height,
                            cube.width,
                        );
                        const material = new THREE.MeshPhongMaterial({
                            color: colors[pieceCount],
                        });
                        const cubeVisual = new THREE.Mesh(geometry, material);
                        cubeVisual.position.set(
                            containerOffset +
                                piece.position.x +
                                cube.x +
                                cube.length / 2,
                            piece.position.z + cube.z + cube.height / 2,
                            piece.position.y + cube.y + cube.width / 2,
                        );
                        pieceVisual.add(cubeVisual);
                        pieceCount++;
                    });
                    contentVisual.add(pieceVisual);
                }
                containers.push(contentVisual);
                scene.add(contentVisual);
                // Create visual for container itself
                const containerVisual = new THREE.Group();
                const geometry = new THREE.BoxGeometry(
                    container.length,
                    container.height,
                    container.width,
                );
                const material = new THREE.MeshPhongMaterial({
                    color: new THREE.Color(`hsl(0, 0%, 100%)`),
                });
                material.wireframe = true;
                const containerMesh = new THREE.Mesh(geometry, material);
                containerVisual.add(containerMesh);
                containerVisual.position.set(
                    containerOffset + container.length / 2,
                    0 + container.height / 2,
                    0 + container.width / 2,
                );
                scene.add(containerVisual);
                // Move to next container
                containerOffset += container.length + 0.5;
            });

            camera.position.z = 5;

            // Update camera to fit all containers
            zoomCameraToSelection(camera, controls, containers, 0.5);

            // Update canvas when window is resized
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
            window.addEventListener("resize", onWindowResize, false);

            // Add event listeners
            const selectColorMode = document.querySelector(
                "select[name=select-color-mode]"
            );
            selectColorMode.value = "sorted";
            // Add custom color maps
            customColorTypes.forEach((colorType) => {
                const option = document.createElement("option");
                option.value = colorType;
                option.innerText = colorType;
                selectColorMode.appendChild(option);
            });
            selectColorMode.addEventListener("change", (event) => {
                const value = event.target.value;
                let p = 0;
                containers.forEach((packing) => {
                    packing.children.forEach((piece) => {
                        piece.children.forEach((cube) => {
                            const material = cube.material;
                            if (value === "sorted") {
                                material.color = colors[p];
                            } else if (value === "random") {
                                material.color = randomColors[p];
                            } else if (value === "index") {
                                material.color = indexColors[pieceIdxByCount[p]];
                            } else {
                                const colorMap = data.data.color_maps[value];
                                if (colorMap) {
                                    const color = colorMap[pieceIdxByCount[p]];
                                    material.color = new THREE.Color(color);
                                } else {
                                    console.warn(
                                        `Color map ${value} not found in data.`
                                    );
                                }
                            }
                            p++;
                        });
                    });
                });
            });

            const composer = new EffectComposer(renderer);
            const renderPass = new RenderPass(scene, camera);
            composer.addPass(renderPass);
            // const glitchPass = new GlitchPass();
            // composer.addPass( glitchPass );
            // const outputPass = new OutputPass();
            // composer.addPass( outputPass );

            function animate() {
                requestAnimationFrame(animate);

                // containers.forEach(packing => {
                //     packing.rotation.x += 0.01;
                //     packing.rotation.y += 0.01;
                // });

                // renderer.render(scene, camera);
                composer.render();
            }

            animate();
        </script>
    </body>
</html>
